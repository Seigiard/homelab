services:
  opds-generator:
    image: ghcr.io/seigiard/opds-generator:latest
    container_name: opds-generator
    restart: unless-stopped
    environment:
      - TZ=${TZ:-Europe/Kyiv}
      - ADMIN_USER=${OPDS_ADMIN_USER:-admin}
      - ADMIN_TOKEN=${OPDS_ADMIN_TOKEN}
    volumes:
      - ${DATA_PATH:-/mnt/data}/public/library:/books:ro
      - ${APPDATA_PATH:-/opt/homelab/appdata}/opds-generator:/data
    networks:
      - traefik-net
    labels:
      # Traefik routing
      - traefik.enable=true
      - traefik.http.routers.opds.rule=Host(`opds.${LOCAL_DOMAIN:-home.local}`) || Host(`opds.${EXTERNAL_DOMAIN:-1218217.xyz}`)
      - traefik.http.routers.opds.entrypoints=web
      - traefik.http.services.opds.loadbalancer.server.port=80
      # Homepage
      - homepage.group=Media
      - homepage.name=OPDS Catalog
      - homepage.icon=calibre
      - homepage.href=http://opds.${LOCAL_DOMAIN:-home.local}
      - homepage.description=E-book OPDS feed

networks:
  traefik-net:
    external: true
