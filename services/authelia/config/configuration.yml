---
# Authelia Configuration
# https://www.authelia.com/configuration/

server:
  address: 'tcp://:9091'

log:
  level: 'info'

totp:
  issuer: 'homelab.1218217.xyz'

authentication_backend:
  file:
    path: '/config/users_database.yml'
    password:
      algorithm: 'argon2id'

session:
  expiration: '1 hour'
  inactivity: '5 minutes'
  remember_me: '1 month'
  redis:
    host: 'authelia-redis'
    port: 6379
  cookies:
    - domain: '1218217.xyz'
      authelia_url: 'https://auth.1218217.xyz'
      default_redirection_url: 'https://1218217.xyz'
      expiration: '1 hour'
      inactivity: '5 minutes'
      remember_me: '1 month'

storage:
  local:
    path: '/data/db.sqlite3'

notifier:
  filesystem:
    filename: '/data/notifications.txt'

access_control:
  default_policy: 'deny'
  rules:
    # Local network - no auth (trusted)
    - domain: ['*.home.local', 'home.local']
      policy: 'bypass'

    # Authelia login page - bypass
    - domain: 'auth.1218217.xyz'
      policy: 'bypass'

    # Personal files - owner + admin only (must be before wildcard)
    - domain: 'a.files.1218217.xyz'
      subject: ['user:andrew', 'group:admins']
      policy: 'one_factor'
    - domain: 'a.files.1218217.xyz'
      policy: 'deny'

    - domain: 'y.files.1218217.xyz'
      subject: ['user:yuliia', 'group:admins']
      policy: 'one_factor'
    - domain: 'y.files.1218217.xyz'
      policy: 'deny'

    # Everything else - any authenticated user
    - domain: ['*.1218217.xyz', '1218217.xyz']
      policy: 'one_factor'
